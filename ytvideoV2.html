<!DOCTYPE html>
<html>
<head>
  <title>YouTube Viewer</title>
  <style>
    body {
      padding: 10px;
      margin: 0;
      font-family: sans-serif;
      background-color: #f9f9f9;
    }
    input, button {
      margin: 5px;
      padding: 8px;
      font-size: 16px;
      background-color: #eee;
      border-radius: 10px;
      border: solid 2px #ddd;
      color: #222;
    }
    input:hover, button:hover {
      background-color: #ddd;
    }
    iframe {
      border: none;
      margin-top: 10px;
    }
    #playlist {
      margin-top: 20px;
      padding: 10px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      max-width: 800px;
    }
    .video-entry {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .video-entry:hover {
      background-color: #f0f0f0;
    }
    .thumb {
      width: 120px;
      height: 90px;
      margin-right: 10px;
      border-radius: 5px;
    }
    .title {
      font-size: 14px;
      color: #333;
    }
  </style>
</head>
<body>
  <input type="text" id="url" placeholder="Paste YouTube URL" onkeydown="handleEnter(event)">
  <button onclick="addToQueue()">Add</button>
  <button onclick="playNext()">Next ▶</button>
  <button onclick="openInNewTab()">↗ Open in New Tab</button>
  <button onclick="theater()">⛶ Theater</button>

  <iframe id="fr" width="892" height="502" src="https://www.youtube.com/embed/" allowfullscreen></iframe>

  <div id="playlist"></div>

  <script>
    let queue = JSON.parse(localStorage.getItem("ytQueue") || "[]");
    let currentIndex = -1;

    function handleEnter(e) {
      if (e.key.toLowerCase() === "enter") {
        addToQueue();
      }
    }

    function addToQueue() {
      const input = document.querySelector("#url").value.trim();
      const videoId = extractVideoId(input);
      if (!videoId) return alert("Invalid YouTube URL");

      const entry = {
        id: videoId,
        title: `Video: ${videoId}`,
        thumb: `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`
      };

      queue.push(entry);
      localStorage.setItem("ytQueue", JSON.stringify(queue));
      renderQueue();

      if (currentIndex === -1) {
        playNext();
      }
    }

    function playNext() {
      if (queue.length === 0) return;
      currentIndex = (currentIndex + 1) % queue.length;
      playVideo(queue[currentIndex]);
    }

    function playVideo(entry) {
      document.querySelector("#fr").src = `https://www.youtube.com/embed/${entry.id}`;
      document.title = entry.title;
    }

    function openInNewTab() {
      if (currentIndex === -1 || !queue[currentIndex]) return;
      const embedUrl = `https://www.youtube.com/embed/${queue[currentIndex].id}`;
      const win = window.open("about:blank", "_blank");
      win.document.write(`
        <iframe width="100%" height="100%" src="${embedUrl}" frameborder="0" allowfullscreen style="border:none;position:fixed;top:0;left:0;width:100vw;height:100vh;"></iframe>
      `);
    }

    function theater() {
      const fr = document.querySelector("#fr");
      fr.style.position = "fixed";
      fr.style.top = "0";
      fr.style.left = "0";
      fr.style.width = "100vw";
      fr.style.height = "100vh";
      fr.style.zIndex = "9999";
      fr.style.margin = "0";
      fr.style.padding = "0";
    }

function extractVideoId(url) {
  const match = url.match(/(?:watch\?v=|shorts\/|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
  return match ? match[1] : null;
}


    function renderQueue() {
      const container = document.querySelector("#playlist");
      container.innerHTML = "<h3>Playlist</h3>";
      queue.forEach((entry, index) => {
        const div = document.createElement("div");
        div.className = "video-entry";
        div.onclick = () => {
          currentIndex = index;
          playVideo(entry);
        };

        const img = document.createElement("img");
        img.src = entry.thumb;
        img.className = "thumb";

        const title = document.createElement("div");
        title.className = "title";
        title.textContent = entry.title;

        div.appendChild(img);
        div.appendChild(title);
        container.appendChild(div);
      });
    }

    renderQueue(); // Load on page start
  </script>
</body>
</html>
